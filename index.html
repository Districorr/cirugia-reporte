<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Generador de Reportes | Districorr</title>
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
</head>
<body>
  <div class="spinner" id="spinner"></div>
  <div class="container">
    <header>
      <img src="https://i.imgur.com/aA7RzTN.png" alt="Districorr Logo" class="logo-header">
      <h2>Generador de Reportes de CirugÃ­a</h2>
    </header>

    <form id="reporteForm">
      <div class="form-group">
        <label for="paciente">Paciente:</label>
        <input type="text" id="paciente" class="form-control" required>
      </div>

      <div class="form-group">
        <label for="medico">MÃ©dico:</label>
        <input type="text" id="medico" class="form-control" required>
      </div>

      <div class="form-group">
        <label for="fechaCirugia">Fecha de CirugÃ­a:</label>
        <input type="date" id="fechaCirugia" class="form-control" required>
      </div>
      <div class="form-group">
     <label for="lugarCirugia">Lugar de CirugÃ­a:</label>
     <input type="text" id="lugarCirugia" class="form-control">
     </div>
      <div class="form-group">
        <label for="tipoCirugia">Tipo de CirugÃ­a:</label>
        <select id="tipoCirugia" class="form-control" required>
          <option value="">Seleccione un tipo</option>
          <!-- Las opciones se cargarÃ¡n con JavaScript -->
        </select>
      </div>

      <div class="form-group">
        <label for="material">Material Requerido:</label>
        <textarea id="material" class="form-control" rows="4" required></textarea>
      </div>

      <div class="form-group">
        <label>Formato del Reporte:</label>
        <div>
          <input type="radio" id="formal" name="formato" value="formal" checked>
          <label for="formal">Formal</label>
          
          <input type="radio" id="moderno" name="formato" value="moderno">
          <label for="moderno">Moderno</label>
          
          <input type="radio" id="casual" name="formato" value="casual">
          <label for="casual">Casual</label>
        </div>
      </div>

      <div class="form-group text-center">
        <button type="button" id="generarBtn" class="btn-link">Generar Reporte</button>
        <button type="button" id="guardarBtn" class="btn-link">Guardar Reporte</button>
        <button type="button" id="limpiarBtn" class="btn-link">Limpiar Formulario</button>
      </div>
    </form>

    <div id="reporteGenerado" class="reporte-box" style="display: none;">
      <h3>Reporte Generado:</h3>
      <div id="reporteTexto"></div>
      <button id="copiarBtn" class="btn-link" style="margin-top: 15px;">Copiar al Portapapeles</button>
    </div>

    <div class="text-center" style="margin-top: 30px;">
      <a href="admin.html" class="btn-link">Ver Reportes Guardados</a>
      <a href="estadisticas.html" class="btn-link">Ver EstadÃ­sticas</a>
    </div>

    <span class="credit">Â© 2023 Districorr - Generador de Reportes de CirugÃ­a</span>
  </div>

  <script>
    // ConfiguraciÃ³n de Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyCFtuuSPCcQIkgDN_F1WRS4U-71pRNCf_E",
      authDomain: "cirugia-reporte.firebaseapp.com",
      projectId: "cirugia-reporte",
      storageBucket: "cirugia-reporte.appspot.com",
      messagingSenderId: "698831567840",
      appId: "1:698831567840:web:fc6d6197f22beba4d88985",
      measurementId: "G-HD7ZLL1GLZ"
    };

    // Inicializar Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Cargar tipos de cirugÃ­a desde el JSON
    document.addEventListener('DOMContentLoaded', function() {
      const tipoCirugiaSelect = document.getElementById('tipoCirugia');
   <!-- En index.html, reemplazar el script existente por este: -->
<script>
  // ConfiguraciÃ³n de Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyCFtuuSPCcQIkgDN_F1WRS4U-71pRNCf_E",
    authDomain: "cirugia-reporte.firebaseapp.com",
    projectId: "cirugia-reporte",
    storageBucket: "cirugia-reporte.appspot.com",
    messagingSenderId: "698831567840",
    appId: "1:698831567840:web:fc6d6197f22beba4d88985",
    measurementId: "G-HD7ZLL1GLZ"
  };

  // Inicializar Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  document.addEventListener('DOMContentLoaded', function() {
    // Cargar tipos de cirugÃ­a
    const tipoCirugiaSelect = document.getElementById('tipoCirugia');
    fetch('tipos_cirugia.json')
      .then(response => response.json())
      .then(data => {
        data.forEach(tipo => {
          const option = document.createElement('option');
          option.value = tipo;
          option.textContent = tipo;
          tipoCirugiaSelect.appendChild(option);
        });
      });

    // Configurar eventos
    document.getElementById('generarBtn').addEventListener('click', generarReporte);
    document.getElementById('guardarBtn').addEventListener('click', guardarReporte);
    document.getElementById('limpiarBtn').addEventListener('click', limpiarFormulario);
    document.getElementById('copiarBtn').addEventListener('click', copiarReporte);
  });

  function obtenerDatos() {
    return {
      paciente: document.getElementById('paciente').value,
      medico: document.getElementById('medico').value,
      lugarCirugia: document.getElementById('lugarCirugia').value,
      fechaCirugia: document.getElementById('fechaCirugia').value,
      tipoCirugia: document.getElementById('tipoCirugia').value,
      material: document.getElementById('material').value,
      mensajeInicio: document.getElementById('mensajeInicio').value,
      formato: document.querySelector('input[name="formato"]:checked').value
    };
  }

  function generarReporte() {
    const d = obtenerDatos();
    const fechaFormateada = new Date(d.fechaCirugia).toLocaleDateString('es-AR');
    
    let reporteTexto = '';
    
    switch(d.formato) {
      case 'formal':
        reporteTexto = `
          <div class="formato-formal">
            <p><strong>${d.mensajeInicio || 'Estimados,'}</strong></p>
            <p>Adjunto detalles de la cirugÃ­a programada:</p>
            <ul>
              <li><strong>Paciente:</strong> ${d.paciente}</li>
              <li><strong>MÃ©dico:</strong> ${d.medico}</li>
              <li><strong>Lugar de CirugÃ­a:</strong> ${d.lugarCirugia || 'No especificado'}</li>
              <li><strong>Fecha de CirugÃ­a:</strong> ${fechaFormateada}</li>
              <li><strong>Tipo de CirugÃ­a:</strong> ${d.tipoCirugia}</li>
            </ul>
            <p><strong>Material Requerido:</strong></p>
            <p>${d.material}</p>
            <p>Saludos cordiales,</p>
            <p>Districorr</p>
          </div>`;
        break;
        
      case 'moderno':
        reporteTexto = `
          <div class="formato-moderno">
            <h4>Reporte de CirugÃ­a - Districorr</h4>
            <p>${d.mensajeInicio || 'Detalles de la cirugÃ­a:'}</p>
            <div style="margin: 15px 0;">
              <p><strong>Paciente:</strong> ${d.paciente}</p>
              <p><strong>MÃ©dico:</strong> ${d.medico}</p>
              <p><strong>Lugar:</strong> ${d.lugarCirugia || 'No especificado'}</p>
              <p><strong>Fecha:</strong> ${fechaFormateada}</p>
              <p><strong>Procedimiento:</strong> ${d.tipoCirugia}</p>
            </div>
            <h5>Materiales solicitados:</h5>
            <div style="background: #f5f5f5; padding: 10px; border-radius: 5px;">
              ${d.material.split('\n').map(item => `<p>â€¢ ${item}</p>`).join('')}
            </div>
          </div>`;
        break;
        
      case 'casual':
        reporteTexto = `
          <div class="formato-casual">
            <p>${d.mensajeInicio || 'Hola equipo,'}</p>
            <p>Les comparto los datos para la cirugÃ­a:</p>
            <div style="margin-left: 20px;">
              <p>ðŸ‘‰ <strong>Paciente:</strong> ${d.paciente}</p>
              <p>ðŸ‘‰ <strong>Dr./Dra.:</strong> ${d.medico}</p>
              <p>ðŸ‘‰ <strong>Lugar:</strong> ${d.lugarCirugia || 'No especificado'}</p>
              <p>ðŸ‘‰ <strong>DÃ­a:</strong> ${fechaFormateada}</p>
              <p>ðŸ‘‰ <strong>CirugÃ­a:</strong> ${d.tipoCirugia}</p>
            </div>
            <p>Necesitamos este material:</p>
            <div style="background: #e8f5e9; padding: 10px; border-radius: 5px;">
              ${d.material.split('\n').map(item => `<p>âœ” ${item}</p>`).join('')}
            </div>
            <p>Â¡Gracias!</p>
          </div>`;
        break;
    }

    document.getElementById('reporteTexto').innerHTML = reporteTexto;
    document.getElementById('reporteGenerado').style.display = 'block';
  }

  function guardarReporte() {
    const d = obtenerDatos();
    
    if (!d.paciente || !d.medico || !d.fechaCirugia || !d.tipoCirugia || !d.material) {
      alert('Por favor complete todos los campos obligatorios');
      return;
    }

    document.getElementById('spinner').style.display = 'block';
    
    db.collection("reportes").add({
      paciente: d.paciente,
      medico: d.medico,
      lugarCirugia: d.lugarCirugia,
      fechaCirugia: d.fechaCirugia,
      tipoCirugia: d.tipoCirugia,
      material: d.material,
      mensajeInicio: d.mensajeInicio,
      formato: d.formato,
      timestamp: firebase.firestore.FieldValue.serverTimestamp()
    })
    .then(() => {
      alert('Reporte guardado exitosamente!');
      document.getElementById('spinner').style.display = 'none';
    })
    .catch(error => {
      console.error("Error al guardar:", error);
      alert('Error al guardar el reporte');
      document.getElementById('spinner').style.display = 'none';
    });
  }

  function copiarReporte() {
    const reporteTexto = document.getElementById('reporteTexto');
    const range = document.createRange();
    range.selectNode(reporteTexto);
    window.getSelection().removeAllRanges();
    window.getSelection().addRange(range);
    document.execCommand('copy');
    window.getSelection().removeAllRanges();
    alert('Reporte copiado al portapapeles!');
  }

  function limpiarFormulario() {
    document.getElementById('reporteForm').reset();
    document.getElementById('reporteGenerado').style.display = 'none';
  }
</script>
</body>
</html>
